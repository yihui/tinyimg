% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tinypng.R
\name{tinypng}
\alias{tinypng}
\alias{optim_png}
\title{Optimize PNG images}
\usage{
tinypng(
  input,
  output = identity,
  level = 2L,
  alpha = FALSE,
  preserve = TRUE,
  recursive = TRUE,
  verbose = TRUE,
  lossy = 0
)

optim_png(...)
}
\arguments{
\item{input}{Path to the input PNG file or directory. If a directory is
provided, all PNG files in the directory (and subdirectories if \code{recursive = TRUE}) will be optimized.}

\item{output}{Path to the output PNG file or directory, or a function that
takes an input file path and returns an output path. When optimizing a
directory, \code{output} should be a directory path or a function.}

\item{level}{Optimization level (0-6). Higher values result in better
compression but take longer.}

\item{alpha}{Optimize transparent pixels for better compression. This is
technically lossy but visually lossless.}

\item{preserve}{Preserve file permissions and timestamps. Ignored when lossy
optimization is enabled (\code{lossy > 0}).}

\item{recursive}{When \code{input} is a directory, recursively process
subdirectories.}

\item{verbose}{Print file size reduction info for each file.}

\item{lossy}{A numeric threshold for the color difference in lossy
processing. Values \verb{<= 0} disable lossy optimization.}

\item{...}{Arguments passed to \code{tinypng()}.}
}
\value{
Character vector of output file paths (invisibly).
}
\description{
Optimize PNG files or directories of PNG files using optional lossy palette
reduction and dithering before lossless compression.
}
\details{
The lossy algorithm uses color difference in the International Commission on
Illumination (CIE) 1976 \eqn{L^*a^*b^*} (often written as CIELAB or Lab)
color space.

For a candidate palette size \code{n}, the image is quantized with \code{n} colors
using nearest-color mapping. Sampled pixels are then \strong{grouped by their
original color}, so each distinct color in the image gets one equal vote
regardless of how many pixels share it (preventing a large uniform
background from masking errors in rarer content colors). The worst-case
\eqn{\Delta E_{76}} within each color group is recorded, and we take the
95th percentile of those per-color values. Bisection on \code{n} (1--256) finds
the smallest palette size whose per-color p95 is \verb{<= lossy}.

\eqn{\Delta E_{76}\approx 2.3} is often considered the just noticeable
difference (JND) threshold. Larger values allow more color difference and
thus smaller
palette and file sizes, with more loss of color fidelity. In theory, \eqn{\Delta
E_{76}} can exceed 100.
}
\examples{
# Create a test PNG
tmp = tempfile()
png(tmp, width = 400, height = 400)
plot(1:10)
dev.off()

# Optimize with different levels
tinypng(tmp, paste0(tmp, "-o1.png"), level = 1)
tinypng(tmp, paste0(tmp, "-o6.png"), level = 6)
tinypng(tmp, paste0(tmp, "-lossy.png"), lossy = 2.3)
}
\references{
\url{https://en.wikipedia.org/wiki/Color_difference}
}
