# tinyimg

[![R-CMD-check](https://github.com/yihui/tinyimg/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/yihui/tinyimg/actions/workflows/R-CMD-check.yaml)

An R package for optimizing and compressing images using Rust libraries. Currently supports PNG optimization via the [oxipng](https://github.com/shssoichiro/oxipng) crate.

## Installation

You can install the development version of tinyimg from GitHub:

```r
# install.packages("remotes")
remotes::install_github("yihui/tinyimg")
```

## Requirements

- R (>= 3.5.0)
- Rust/Cargo (>= 1.56.0)

The package includes vendored Rust dependencies per CRAN policy, so you don't need internet access during installation.

## Usage

### Basic PNG optimization

```r
library(tinyimg)

# Optimize a PNG file in-place (overwrites the original)
optim_png("path/to/image.png")

# Optimize and save to a different file
optim_png("input.png", "output.png")

# Use maximum optimization (slower but better compression)
optim_png("image.png", level = 6)

# Use fast optimization
optim_png("image.png", level = 0)
```

### Optimization levels

The `level` parameter controls the optimization level (0-6):

- `0`: Fast optimization with minimal compression
- `2`: Default - good balance between speed and compression
- `6`: Maximum optimization - best compression but slower

## For Package Developers

### Updating Rust Dependencies

The Rust dependencies are vendored and compressed into `src/rust/vendor.tar.xz` (following the [gifski](https://github.com/r-rust/gifski) approach). To update them:

```bash
# Run the update script
./update-vendor.sh
```

This script will:
1. Update Cargo.lock
2. Vendor all dependencies into `src/rust/vendor/`
3. Trim unnecessary files (tests, docs, etc.)
4. Apply patches to fix R CMD check warnings
5. Create compressed `vendor.tar.xz` archive

During development, the `vendor/` directory is used. For CRAN releases, only `vendor.tar.xz` is included in the package (the Makevars extracts it automatically during build).

Note: The `.cargo/config.toml` file is automatically generated by the `configure` script during package installation.

## License

MIT License. See LICENSE file for details.
